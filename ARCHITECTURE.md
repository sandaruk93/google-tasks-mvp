# Application Architecture

## 🏗️ **System Architecture Overview**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Browser   │  │   Mobile    │  │   Desktop   │  │   API       │    │
│  │   Client    │  │   Client    │  │   Client    │  │   Client    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        LOAD BALANCER / PROXY                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Rate      │  │   SSL/TLS   │  │   Health    │  │   Request   │    │
│  │   Limiting  │  │   Termination│  │   Checks    │  │   Routing   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SECURITY MIDDLEWARE STACK                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Helmet    │  │     CORS    │  │ Compression │  │     HPP     │    │
│  │   (Headers) │  │  (CORS)     │  │ (Performance)│  │ (Pollution) │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ MongoSanitize│  │ Rate Limit │  │Speed Limiter│  │Request Logger│    │
│  │ (NoSQL Inj) │  │ (Abuse)    │  │ (Gradual)   │  │ (Audit)     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │Session Valid│  │Sanitize Body│  │Sanitize Query│  │Validate Size│    │
│  │ (Sessions)  │  │ (XSS)       │  │ (Injection) │  │ (Limits)    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AUTHENTICATION LAYER                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   OAuth 2.0 │  │   Token     │  │   Session   │  │   CSRF      │    │
│  │   (Google)  │  │ Validation  │  │ Management  │  │ Protection  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   JWT       │  │   Refresh   │  │   Expiry    │  │   Secure    │    │
│  │   Tokens    │  │   Tokens    │  │   Handling  │  │   Cookies   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AUTHORIZATION LAYER                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Resource  │  │   User      │  │   Role      │  │   Permission│    │
│  │   Access    │  │   Context   │  │   Based     │  │   Checks    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Audit     │  │   Logging   │  │   Tracking  │  │   Monitoring│    │
│  │   Events    │  │   Security  │  │   User      │  │   Access    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        VALIDATION LAYER                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Input     │  │   File      │  │   Request   │  │   Schema    │    │
│  │   Sanitize  │  │   Upload    │  │   Size      │  │   Validation│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   XSS       │  │   SQL       │  │   Path      │  │   Content   │    │
│  │   Protection│  │   Injection │  │   Traversal │  │   Type      │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        APPLICATION LAYER                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Task      │  │   File      │  │   Text      │  │   Account   │    │
│  │   Management│  │   Processing│  │   Processing│  │   Management│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   OAuth     │  │   Gemini    │  │   PDF       │  │   Session   │    │
│  │   Callback  │  │   AI        │  │   Parsing   │  │   Handling  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        EXTERNAL SERVICES                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Google    │  │   Google    │  │   Gemini    │  │   Cloud     │    │
│  │   OAuth     │  │   Tasks API │  │   AI API    │  │   Storage   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 **Request Flow Architecture**

```
Client Request
     │
     ▼
┌─────────────────┐
│  Load Balancer  │ ← Rate Limiting, SSL Termination
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Security Stack  │ ← Helmet, CORS, Compression, HPP
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Rate Limiting   │ ← IP-based rate limiting
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Input Sanitize  │ ← XSS Protection, Injection Prevention
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Authentication  │ ← OAuth 2.0, Token Validation
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Authorization   │ ← Resource Access Control
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Validation      │ ← Request/File Validation
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Business Logic  │ ← Task Management, File Processing
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ External APIs   │ ← Google APIs, Gemini AI
└─────────────────┘
     │
     ▼
┌─────────────────┐
│ Response        │ ← Security Headers, Logging
└─────────────────┘
     │
     ▼
Client Response
```

## 🛡️ **Security Architecture Layers**

### **Layer 1: Network Security**
```
┌─────────────────────────────────────────────────────────────────┐
│                    NETWORK SECURITY                           │
├─────────────────────────────────────────────────────────────────┤
│  • SSL/TLS Encryption (HTTPS)                                │
│  • Load Balancer Rate Limiting                               │
│  • DDoS Protection                                           │
│  • IP Whitelisting/Blacklisting                              │
│  • Health Checks                                             │
└─────────────────────────────────────────────────────────────────┘
```

### **Layer 2: Application Security Headers**
```
┌─────────────────────────────────────────────────────────────────┐
│                APPLICATION SECURITY HEADERS                   │
├─────────────────────────────────────────────────────────────────┤
│  • X-Frame-Options: DENY                                     │
│  • X-Content-Type-Options: nosniff                          │
│  • X-XSS-Protection: 1; mode=block                          │
│  • Referrer-Policy: strict-origin-when-cross-origin         │
│  • Permissions-Policy: geolocation=(), microphone=()         │
│  • Content-Security-Policy                                   │
└─────────────────────────────────────────────────────────────────┘
```

### **Layer 3: Authentication & Authorization**
```
┌─────────────────────────────────────────────────────────────────┐
│              AUTHENTICATION & AUTHORIZATION                   │
├─────────────────────────────────────────────────────────────────┤
│  • OAuth 2.0 with Google                                     │
│  • JWT Token Management                                       │
│  • Secure Cookie Storage (HttpOnly, Secure, SameSite)        │
│  • CSRF Token Protection                                      │
│  • Session Management                                         │
│  • Resource Access Control                                    │
└─────────────────────────────────────────────────────────────────┘
```

### **Layer 4: Input Validation & Sanitization**
```
┌─────────────────────────────────────────────────────────────────┐
│            INPUT VALIDATION & SANITIZATION                    │
├─────────────────────────────────────────────────────────────────┤
│  • XSS Protection (sanitize-html, xss)                       │
│  • SQL Injection Prevention (express-mongo-sanitize)         │
│  • HTTP Parameter Pollution Prevention (hpp)                  │
│  • File Upload Security (MIME, content, size validation)     │
│  • Request Size Limits                                        │
│  • Input Schema Validation (express-validator)                │
└─────────────────────────────────────────────────────────────────┘
```

### **Layer 5: Rate Limiting & Abuse Prevention**
```
┌─────────────────────────────────────────────────────────────────┐
│            RATE LIMITING & ABUSE PREVENTION                   │
├─────────────────────────────────────────────────────────────────┤
│  • General API: 100 requests/15min per IP                    │
│  • Authentication: 5 requests/15min per IP                   │
│  • File Uploads: 10 uploads/hour per IP                      │
│  • Task Operations: 50 operations/15min per IP               │
│  • Speed Limiting (gradual slowdown)                         │
│  • IP-based Tracking                                         │
└─────────────────────────────────────────────────────────────────┘
```

## 📊 **Data Flow Architecture**

### **File Upload Flow**
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───▶│   Multer    │───▶│ Validation  │───▶│ PDF Parse   │
│   Upload    │    │   (Memory)  │    │   (Security)│    │   (Content) │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                              │
                                                              ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Gemini    │◀───│   Action    │◀───│   Text      │◀───│   Cleanup   │
│   AI API    │    │   Items     │    │   Extraction│    │   (Memory)  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### **Task Creation Flow**
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───▶│   Input     │───▶│   Google    │───▶│   Google    │
│   Request   │    │ Validation  │    │   OAuth     │    │   Tasks API │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                              │
                                                              ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Response  │◀───│   Logging   │◀───│   Task      │◀───│   Success   │
│   (JSON)    │    │   (Audit)   │    │   Creation  │    │   Response  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 🏢 **Component Architecture**

### **Core Components**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           CORE COMPONENTS                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Server    │  │   App       │  │   Routes    │  │   Middleware│    │
│  │   (server.js)│  │   (app.js)  │  │   (API)     │  │   (Stack)   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Config    │  │   Logger    │  │   Security  │  │   Validation│    │
│  │   (Config)  │  │   (Winston) │  │   (Config)  │  │   (Rules)   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### **Security Components**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SECURITY COMPONENTS                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Auth      │  │   File      │  │   Rate      │  │   Logging   │    │
│  │   (OAuth)   │  │   Upload    │  │   Limiting  │  │   (Security)│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Headers   │  │   CORS      │  │   Sanitize  │  │   Validation│    │
│  │   (Helmet)  │  │   (CORS)    │  │   (Input)   │  │   (Rules)   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### **External Services**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        EXTERNAL SERVICES                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Google    │  │   Google    │  │   Gemini    │  │   Cloud     │    │
│  │   OAuth     │  │   Tasks     │  │   AI        │  │   Storage   │    │
│  │   (Auth)    │  │   (API)     │  │   (AI)      │  │   (Files)   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🔧 **Deployment Architecture**

### **Container Architecture**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        DOCKER CONTAINER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Node.js   │  │   Alpine    │  │   Non-root  │  │   Health    │    │
│  │   Runtime   │  │   Linux     │  │   User      │  │   Checks    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Security  │  │   Logs      │  │   Uploads   │  │   Config    │    │
│  │   Updates   │  │   Directory │  │   Directory │  │   Files     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### **Environment Configuration**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ENVIRONMENT CONFIGURATION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Google    │  │   Security  │  │   Logging   │  │   Rate      │    │
│  │   OAuth     │  │   Secrets   │  │   Config    │  │   Limiting  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Gemini    │  │   CORS      │  │   File      │  │   Monitoring│    │
│  │   AI API    │  │   Origins   │  │   Upload    │  │   Config    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 📈 **Scalability Architecture**

### **Horizontal Scaling**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Load Balancer │───▶│   Container 1   │    │   Container N   │
│   (Nginx/HAProxy)│    │   (Node.js App) │    │   (Node.js App) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Redis Cache   │    │   Shared Logs   │    │   External APIs │
│   (Sessions)    │    │   (Winston)     │    │   (Google/Gemini)│
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### **Performance Optimization**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    PERFORMANCE OPTIMIZATION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Gzip      │  │   Memory    │  │   Request   │  │   Response  │    │
│  │ Compression │  │   Cleanup   │  │   Caching   │  │   Streaming │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Async     │  │   Connection│  │   Error     │  │   Graceful   │    │
│  │   Processing│  │   Pooling   │  │   Handling  │  │   Shutdown  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🔍 **Monitoring & Observability**

### **Logging Architecture**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    LOGGING ARCHITECTURE                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Console   │  │   File      │  │   Security  │  │   Error     │    │
│  │   Logs      │  │   Logs      │  │   Logs      │  │   Logs      │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Audit     │  │   Request   │  │   Performance│  │   Security  │    │
│  │   Logs      │  │   Logs      │  │   Logs      │  │   Events    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### **Monitoring Stack**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Application   │───▶│   Winston       │───▶│   Log Files     │
│   (Node.js)     │    │   Logger        │    │   (logs/)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Security      │    │   Performance   │    │   Error         │
│   Events        │    │   Metrics       │    │   Tracking      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🧪 **Testing Architecture**

### **Test Pyramid**
```
                    ┌─────────────────┐
                    │   E2E Tests     │ ← Security Integration Tests
                    │   (Security)    │
                    └─────────────────┘
                           │
                    ┌─────────────────┐
                    │ Integration     │ ← API Security Tests
                    │ Tests           │
                    └─────────────────┘
                           │
                    ┌─────────────────┐
                    │ Unit Tests      │ ← Security Unit Tests
                    │ (Security)      │
                    └─────────────────┘
```

### **Security Test Categories**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SECURITY TEST CATEGORIES                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Auth      │  │   Input     │  │   File      │  │   Rate      │    │
│  │   Tests     │  │   Validation│  │   Upload    │  │   Limiting  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Security  │  │   CSRF      │  │   Error     │  │   Session   │    │
│  │   Headers   │  │   Protection│  │   Handling  │  │   Management│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

**Architecture Version**: 1.0.0
**Last Updated**: [Current Date]
**Security Level**: Enterprise-grade
**Scalability**: Horizontal scaling ready
**Monitoring**: Comprehensive logging and observability 